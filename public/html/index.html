<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AECO-DEV | Gest√£o de Materiais</title>

    <link rel="stylesheet" href="https://developer.api.autodesk.com/modelderivative/v2/viewers/7.*/style.min.css" type="text/css">
    <link rel="stylesheet" href="/css/styles.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body>

    <div id="loginOverlay" class="login-overlay">
        <div class="login-box">
            <div class="login-logo">üèóÔ∏è AECO-DEV</div>
            <h1>Gest√£o Integrada de Materiais</h1>
            <p>Plataforma de auditoria BIM e controlo de especifica√ß√µes.</p>
            <button id="btnLoginBig" class="btn-primary-large">üîê Entrar com Autodesk</button>
            <div style="margin-top: 25px; padding-top: 20px; border-top: 1px solid #eee;">
                <button id="btnBypass" class="btn-secondary">üöÄ Entrar em Modo Demo (Offline)</button>
            </div>
        </div>
    </div>

    <header class="header-bar">
        <div class="logo">A E C O - D E V</div>
        <div class="input-group">
            <button id="btnLoginHeader" class="btn-small" style="display:none;">Login</button>
            <input type="text" id="urnInput" placeholder="Cole aqui o URN do Modelo...">
            <button id="btnLoadModel" disabled>Carregar Modelo</button>
            <a href="/ifc-viewer" class="btn-link">Ir para IFC Viewer</a>
        </div>
        <span id="statusIndicator" class="status">A verificar...</span>
    </header>

    <main class="main-content">
        <aside class="sidebar">
            <div class="sidebar-section">
                <h3>üõ†Ô∏è Auditoria BIM</h3>
                <button id="btnAudit" class="btn-action" disabled>üîç Auditar Modelo</button>
                <button id="btnClearColors" class="btn-secondary" disabled>Limpar Cores</button>
                <div id="auditLegend" class="legend-box hidden">
                    <div class="legend-item"><span class="dot green"></span> Validado</div>
                    <div class="legend-item"><span class="dot red"></span> N√£o Encontrado</div>
                    <div id="auditStats" class="audit-stats"></div>
                </div>
            </div>
        </aside>

        <div id="centralPanel">
            <div id="viewerContainer"></div>

            <section id="materialsListSection">
                <div class="section-header">
                    <h3>Base de Dados de Materiais</h3>

                    <input type="text" id="filterInput" placeholder="üîç Pesquisar material..."
                           style="padding: 6px 10px; border-radius: 4px; border: 1px solid #ccc; width: 200px; font-size: 0.9em;">

                    <div style="display: flex; gap: 10px;">
                        <button id="btnToggleView" class="btn-secondary" title="Alternar Vista" style="padding: 5px 10px;">
                            <span class="material-icons" style="font-size: 1.2em; vertical-align: middle;">grid_view</span>
                        </button>
                        <button id="btnOpenAddModal" class="btn-small-add">+ Novo Material</button>
                    </div>
                </div>

                <div id="tableContainer" class="table-container">
                    <table id="materialsTable" class="simple-table">
                        <thead>
                            <tr>
                                <th>Imagem</th>
                                <th>Nome</th>
                                <th>Marca</th>
                                <th>Categoria</th>
                                <th>Pre√ßo</th>
                                <th>Fornecedor</th>
                                <th style="text-align:center;">A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="materialsTableBody">
                            <tr><td colspan="7">A carregar materiais...</td></tr>
                        </tbody>
                    </table>
                </div>

                <div id="materialsGrid" class="materials-grid hidden">
                    </div>
            </section>
        </div>
    </main>

    <div id="productModal" class="modal hidden">
        <div class="modal-content">
            <span id="closeModal" class="close-btn">&times;</span>
            <div class="modal-header">
                <h2 id="modalTitle">Nome do Produto</h2>
                <span id="modalCategory" class="badge">Categoria</span>
            </div>
            <div class="modal-body">
                <div class="modal-image-col">
                    <img id="modalImage" src="" alt="Imagem do Produto">
                </div>
                <div class="modal-info-col">
                    <div class="info-group"><label>Marca:</label><p id="modalBrand">-</p></div>
                    <div class="info-group"><label>Fornecedor:</label><p id="modalSupplier">-</p></div>
                    <div class="info-group"><label>Pre√ßo:</label><p id="modalPrice" class="price-text">-</p></div>
                    <div class="info-group"><label>Par√¢metros T√©cnicos:</label><p id="modalTechParams" style="background:#f1f1f1; padding:10px; border-radius:4px;">-</p></div>
                    <div class="info-group"><label>Descri√ß√£o:</label><p id="modalDesc">-</p></div>
                </div>
            </div>
        </div>
    </div>

    <div id="addMaterialModal" class="modal hidden">
        <div class="modal-content" style="width: 450px;">
            <span id="closeAddModal" class="close-btn">&times;</span>
            <div class="modal-header"><h2>Adicionar Novo Material</h2></div>
            <div class="modal-body" style="flex-direction: column;">
                <form id="addMaterialForm" style="display:flex; flex-direction:column; gap:10px; width:100%;">
                    <label>Nome *</label><input type="text" id="newMatName" required class="form-input">
                    <label>Categoria</label>
                    <select id="newMatCategory" class="form-input">
                        <option value="Revestimentos">Revestimentos</option>
                        <option value="Isolamento">Isolamento</option>
                        <option value="Estrutura">Estrutura</option>
                        <option value="Carpintaria">Carpintaria</option>
                        <option value="Vidros">Vidros</option>
                        <option value="Instala√ß√µes">Instala√ß√µes</option>
                        <option value="Outros">Outros</option>
                    </select>
                    <label>Marca</label><input type="text" id="newMatBrand" class="form-input">
                    <label>Pre√ßo (‚Ç¨)</label><input type="number" id="newMatPrice" step="0.01" class="form-input">
                    <label>Fornecedor</label><input type="text" id="newMatSupplier" class="form-input">
                    <label>Par√¢metros T√©cnicos</label><textarea id="newMatTechParams" rows="2" class="form-input"></textarea>
                    <label>Descri√ß√£o</label><textarea id="newMatDesc" rows="2" class="form-input"></textarea>
                    <div style="margin-top:20px; display:flex; gap:10px;">
                        <button type="submit" class="btn-action">üíæ Gravar no Airtable</button>
                        <button type="button" id="btnCancelAdd" class="btn-secondary">Cancelar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <footer style="
        position: fixed; bottom: 0; left: 0; width: 100%;
        background: #333; color: white; text-align: center;
        padding: 10px; font-size: 0.8em; z-index: 2000;">
        AECO-DEV ¬© 2025 | Desenvolvido para a UC FAPAC | Vers√£o 1.0.2
    </footer>
    <script src="https://developer.api.autodesk.com/modelderivative/v2/viewers/7.*/viewer3D.min.js"></script>
    <script src="/js/viewer.js"></script>

</body>

</html>